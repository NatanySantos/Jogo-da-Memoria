<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="bootstrap/dist/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="style.css">
	<title>Jogo da Memoria</title>
</head>

<body>
	<nav class="navbar navbar-dark bg-dark">
		<div class="container">
			<div class="navbar-header">
		  		<a class="navbar-brand" href="#"></a>
			
			</div>
		</div>
	</nav>
	<!-- <div class="col-md-2"></div>
	<div class="col-sm-8" -->
	  <br><br> 

	  <div class="container">
	  	<h1 class="titulo"> Bem-vindo(a) </h1>
		<h3 class="linha">Nome: <span id="nome"></span>  Idade: <span id="idade"></span></h3>
		

		<div class="row">
			
			<div id="tempo" >
				<span style="color: red; left: 30%; top: 60%; width: 40%; text-align: center; position: absolute; font-size: 45px;" id="cronometro" ></span>

			</div>
			<div class="col-md-4"></div>
			<div class="col-md-4" >
				<h2 > Pontuação: 
					<span id="pontuation"></span>
				</h2>
			</div>
			
		
	  </div>
	 </div>

	  <br>
	  <div style="text-align: center">
	  	<div id="deck" ></div>
	  	<div id="deck2"></div>
	  </div>
	


	<script type="text/javascript">
	
	
		var totalCards = 20;
		var pontos = 0;
		var naipes = ["E","O","P","C"];
		var cartas = [];
		var isTurned = false;
		var turnedCard;
		var tempo = 160;
		var timeId = null; //variavel que armazena a chamada da funcao Timeout

			//pegando os dados do usuario
			var url = window.location.search.replace("?", "");
			var nome = url.split("&")[0];
			var idade = url.split("&")[1];
			document.getElementById("nome").innerHTML = nome;
			document.getElementById("idade").innerHTML = idade;
			console.log(nome);
			console.log(idade);

			document.getElementById('cronometro').innerHTML = tempo;

		function createElements(){
			for(var i = 1; i <= 10; i++){
				var cardNumber = Math.floor(Math.random() * 13 + 1);
				var newCard = new Carta(cardNumber);
				var newImage = document.createElement("img");
				var path = "img/verso.jpg";
				//var path = "img/" + newCard.numero + newCard.naipe + ".png";
				var id = newCard.numero + newCard.naipe; 
				newImage.setAttribute('src', path);
				newImage.setAttribute('width', '135px');
				newImage.setAttribute('id',id);
				newImage.setAttribute('onclick','turnCard(this.id);')
				var div = document.getElementById("deck");
				div.appendChild(newImage);
				cartas.push(newCard);

			}
							
		};

		function selectCards(){
			var vetor = [0,0,0,0,0,0,0,0,0,0];
			var verifica;

			for(var j = 1; j<= 10; j++){
				verifica = true;
				var i;
				while(verifica){
				i = Math.floor(Math.random() * cartas.length);
				if(vetor[i] == 0)
					verifica = false;

				}
				vetor[i]=1;
				var path = "img/verso.jpg";
				//var path = "img/" + cartas[i].numero + cartas[i].naipe + ".png";
				var newImage = document.createElement("img");
				var id = "second" + cartas[i].numero + cartas[i].naipe;
				newImage.setAttribute('src', path);
				newImage.setAttribute('width', '135px');
				newImage.setAttribute('id', id);
				newImage.setAttribute('onclick','turnCard(this.id);')
				var div2 = document.getElementById("deck2");
				div2.appendChild(newImage);
			}
		};

		function exibeCartas(){
			for(var i = 0; i < cartas.length; i++){
				console.log("Naipe da carta: " + cartas[i].naipe + " | Numero da carta: " + cartas[i].numero);
			}	
		}

		function exibePontuacao(){
			var placar = document.getElementById('pontuation');
			placar.innerHTML = pontos;
		}

		function turnCard(id){
			var carta = document.getElementById(id);
			contagem(tempo + 1);
			//console.log(id);
			if(isTurned){		
				var path = getImage(id);
				carta.setAttribute('src',path);
				//turnedCard = {'id': id, 'match': generateMatch(id)};
				if(turnedCard.match == id){
					pontos++;
					alert("Você recebeu 1 ponto!");
					exibePontuacao();
					 carta.setAttribute('onclick','');
					 var otherCard = document.getElementById(turnedCard.id);
					 otherCard.setAttribute('onclick','');
					 turnedCard = {};
					 isTurned = false;

					 if(pontos == 10){
					 	alert("Cê ganhou! Obrigado por perder seu tempo conosco!");
					 }
				}

				else{
					var path = "img/verso.jpg";
					carta.setAttribute('src',path);
					var otherCard = document.getElementById(turnedCard.id);
					otherCard.setAttribute('src',path);
					isTurned = false;
				}
			}
			else{
				var path = getImage(id);
				carta.setAttribute('src',path);
				turnedCard = {'id': id, 'match': generateMatch(id)};
				isTurned = true;
			}
		}

		function getImage(id){
			var identity = checkId(id);
			return "img/" + identity + ".png";
		}

		function generateMatch(id){
			var identity = id.toString();
			if(identity.startsWith("second")){
				iden = identity.replace("second","");
				return iden;
			}else{
				iden = "second"+identity;
				return iden;
			}
		}
		function checkId(id){
			var identity = id.toString();
			if(identity.startsWith("second")){
				iden = identity.replace("second","");
				return iden;
			}else{
				return identity;
			}
		}

		function turnAll(){

		}

			document.getElementById('cronometro').innerHTML = tempo;

			//executa essa funcao a cada milisegundos
			//timeId = setTimeout("contagem("+segundos+")", 1000);
		//}


		function verifica(numero){
			var variety = 0;
			for (var i = 0; i < cartas.length; i++){
				//console.log(cartas[i].numero+" - " +numero );
				if (cartas[i].numero == numero){
					//alert(cartas[i].numero);
					variety++;	
				}
			}
			return variety;
		}


		function Carta(numero){
			this.numero = numero;
			this.naipe = setNaipe();

			function setNaipe(){
				var variety = verifica(numero);

				if(variety == 0){
					var proximo = Math.floor(Math.random() * naipes.length);
					// console.log("numero nao consta no baralho");	
					// console.log("numero "+ numero+ " naipe "+naipes[proximo]);
					return naipes[proximo];

				}
				else{
					
				
					var ver=true;
					var n ;
					//console.log("Troca naipe -> Numero "+ numero  );

					for(var i = 0; i < cartas.length; i++)
					{	
						if(cartas[i].numero == numero )
						{
							
							while(ver){
								n = Math.floor(Math.random() * naipes.length);
								//console.log(" naipe sortiado"+naipes[n]);
								ver=testa(i, naipes[n]);

							}

						//console.log("naipe escolhido "+ naipes[n]);
						return naipes[n];
						}
						
						
					}


					
				}
			}
		}; //Fim do objeto

		//verifica se o numero da carta sorteada é igual a algum numero que ja existe no baralho e se o nipe sorteado ja existe no baralho
		function testa(index, n){
			

			for(var i = 0; i < cartas.length; i++)
			{
				if((cartas[index].numero== cartas[i].numero) && (cartas[i].naipe == n)){
					//console.log("naipe existe ");
					// console.log(" naipes dentr: "+ cartas[index].naipe);
					return true;
				}

			}

			 //console.log("naipe nao existe");
			return false;



		}

		// function contagem(segundos) {

		// 	segundos --;

		// 	if (segundos == -1) {
		// 		clearTimeout(timeId); //para a execução da função do setTimeout
		// 		//game_over();
		// 		return false;
		// 	}


		// function parar_jogo() {
		// 	clearTimeout(timeId);
		// }

		// function game_over() {
		// 	remove_eventos_cartas();
		// 	alert('Fim de jogo, voce nao conseguiu encontrar todos os pares a tempo.');
		// }



		createElements(); 
		selectCards();//Chamando a função para criar novas cartas
		exibeCartas(); //exibe cartas criadas no console

		

	</script>
</body>
